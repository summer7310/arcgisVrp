/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
require({cache:{"url:esri/dijit/templates/LayerSwipe.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\n    \x3cdiv title\x3d"${_i18n.widgets.layerSwipe.title}" data-dojo-attach-point\x3d"_moveableNode"\x3e\n        \x3cdiv class\x3d"${_css.handleContainer}"\x3e\n            \x3cdiv class\x3d"${_css.handle}"\x3e\x3c/div\x3e\n        \x3c/div\x3e\n    \x3c/div\x3e\n\x3c/div\x3e'}});
define("esri/dijit/LayerSwipe","dojo/Evented dojo/_base/declare dojo/_base/lang dojo/has esri/kernel dijit/_WidgetBase dijit/_TemplatedMixin dojo/on dojo/text!esri/dijit/templates/LayerSwipe.html dojo/i18n!esri/nls/jsapi dojo/dom-class dojo/dom-style dojo/dnd/move dojo/dnd/Mover dojo/sniff dojo/dom-geometry esri/geometry/Point dojo/dom-construct dojo/Deferred dojo/promise/all".split(" "),function(r,x,h,z,A,B,C,p,D,E,u,t,v,F,s,q,G,H,y,I){var w=x([F],{onFirstMove:function(a){var b=this.node.style,c,
e=this.host;switch(b.position){case "relative":case "absolute":c=Math.round(parseFloat(b.left))||0;b=Math.round(parseFloat(b.top))||0;break;default:b.position="absolute",b=q.getMarginBox(this.node),c=b.l,b=b.t}this.marginBox.l=c-this.marginBox.l;this.marginBox.t=b-this.marginBox.t;if(e&&e.onFirstMove)e.onFirstMove(this,a);this.events.shift().remove()}});r=x([B,C,r],{declaredClass:"esri.dijit.LayerSwipe",templateString:D,options:{theme:"LayerSwipe",layers:[],enabled:!0,type:"vertical",clip:9},constructor:function(a,
b){var c=h.mixin({},this.options,a);this.domNode=b;this._i18n=E;this.set("map",c.map);this.set("layers",c.layers);this.set("top",c.top);this.set("left",c.left);this.set("theme",c.theme);this.set("enabled",c.enabled);this.set("type",c.type);this.set("clip",c.clip);this.watch("theme",this._updateThemeWatch);this.watch("enabled",this._enabled);this.watch("type",this._type);this._css={handleContainer:"handleContainer",handle:"handle"};this._listeners=[]},startup:function(){this.map||(this.destroy(),console.log("LayerSwipe::map required"));
this.set("layers",this.layers);this.layers.length||(this.destroy(),console.log("LayerSwipe::layer required"));this._allLoaded().then(h.hitch(this,function(){this._init()}))},destroy:function(){this._removeEvents();this._unclipLayers();this.inherited(arguments)},swipe:function(){this._setClipValue();this._swipe()},enable:function(){this.set("enabled",!0)},disable:function(){this.set("enabled",!1)},_allLoaded:function(){for(var a=[],b=0;b<this.layers.length;b++){"string"===typeof this.layers[b]&&(this.layers[b]=
this.map.getLayer(this.layers[b]),this.layers[b]||console.log("LayerSwipe::Could not get layer by ID"));var c=new y;this.layers[b].loaded?c.resolve("layer loaded"):this._layerLoadedPromise(b,c);a.push(c.promise)}var e=new y;if(this.map.loaded)e.resolve("map loaded");else p.once(this.map,"load",h.hitch(this,function(){e.resolve("map loaded")}));a.push(e.promise);return I(a)},_layerLoadedPromise:function(a,b){p.once(this.layers[a],"load",function(){b.resolve("layer loaded")})},_mb:function(){var a=
q.getMarginBox(this.map.root),b={t:0,l:0};b.w=a.l+a.w;b.h=a.h+a.t;return b},_setSwipeType:function(){var a,b;this.get("type")&&(this._swipeslider&&this._swipeslider.destroy(),u.add(this._moveableNode,this.get("type")),a=q.getMarginBox(this._moveableNode),"scope"===this.get("type")?(this._swipeslider=new v.constrainedMoveable(this._moveableNode,{handle:this._moveableNode.id,constraints:h.hitch(this,this._mb),within:!0,mover:w}),b=this.map.width/2-a.w/2,a=this.map.height/2-a.h/2,"undefined"!==typeof this.get("top")&&
(a=this.get("top")),"undefined"!==typeof this.get("left")&&(b=this.get("left"))):"horizontal"===this.get("type")?(this._swipeslider=new v.parentConstrainedMoveable(this._moveableNode,{area:"content",within:!0,mover:w}),b=0,a=this.map.height/4-a.h/2,"undefined"!==typeof this.get("top")&&(a=this.get("top")),this._clipval=a):(this._swipeslider=new v.parentConstrainedMoveable(this._moveableNode,{area:"content",within:!0,mover:w}),b=this.map.width/4-a.w/2,a=0,"undefined"!==typeof this.get("left")&&(b=
this.get("left")),this._clipval=b),t.set(this._moveableNode,{top:a+"px",left:b+"px"}))},_init:function(){this._setSwipeType();H.place(this.domNode,this.map._layersDiv,"last");this._setupEvents();this._enabled();this.set("loaded",!0);this.emit("load",{});this.swipe()},_removeEvents:function(){if(this._listeners&&this._listeners.length)for(var a=0;a<this._listeners.length;a++)this._listeners[a]&&this._listeners[a].remove();this._listeners=[]},_setClipValue:function(){var a=q.getMarginBox(this._moveableNode);
"vertical"===this.get("type")?(a=a.l,this._clipval=0>=a?0:a>=this.map.width?this.map.width:a):"horizontal"===this.get("type")&&(a=a.t,this._clipval=0>=a?0:a>=this.map.height?this.map.height:a)},_setupEvents:function(){this._removeEvents();this._swipeMove=p.pausable(this._swipeslider,"Move",h.hitch(this,function(){this.swipe()}));this._listeners.push(this._swipeMove);this._swipePanEnd=p.pausable(this.map,"pan-end",h.hitch(this,function(){this._swipe()}));this._listeners.push(this._swipePanEnd);this._mapUpdateStart=
p.pausable(this.map,"update-start",h.hitch(this,function(){this._swipe()}));this._listeners.push(this._mapUpdateStart);this._mapUpdateEnd=p.pausable(this.map,"update-end",h.hitch(this,function(){this._swipe()}));this._listeners.push(this._mapUpdateEnd);"css-transforms"===this.map.navigationMode&&(this._swipePan=p.pausable(this.map,"pan",h.hitch(this,function(){this._swipe()})),this._listeners.push(this._swipePan));this._toolClick=p.pausable(this._moveableNode,"click",h.hitch(this,function(a){if("scope"===
this.get("type")){if(this.map.hasOwnProperty("onClick")&&"function"===typeof this.map.onClick&&this._clickCoords&&this._clickCoords.x===a.x&&this._clickCoords.y===a.y){var b=q.position(this.map.root,!0),c=a.pageX-b.x,b=a.pageY-b.y;a.x=c;a.y=b;a.screenPoint={x:c,y:b};a.type="click";a.mapPoint=this.map.toMap(new G(c,b,this.map.spatialReference));this.map.onClick(a,"other")}this._clickCoords=null}}));this._listeners.push(this._toolClick);this._evtCoords=p.pausable(this._swipeslider,"MouseDown",h.hitch(this,
function(a){"scope"===this.get("type")&&(this._clickCoords={x:a.x,y:a.y})}));this._listeners.push(this._evtCoords)},_swipe:function(){if(this.get("loaded")&&this.get("enabled")){var a={layers:[]};if(this.layers&&this.layers.length)for(var b=0;b<this.layers.length;b++){var c=this.layers[b]._div,e=this.layers[b].graphics,k,f,g,l,d,n,h;n=q.getMarginBox(this._moveableNode);if("vertical"===this.get("type")||"horizontal"===this.get("type"))c&&(d=q.getMarginBox(c)),h=q.getMarginBox(this.map.root);"vertical"===
this.get("type")?(d&&0<d.l?(k=this._clipval-Math.abs(d.l),f=-d.l):d&&0>d.l?(f=0,k=this._clipval+Math.abs(d.l)):(f=0,k=this._clipval),d&&0<d.t?(g=-d.t,l=h.h-d.t):d&&0>d.t?(g=0,l=h.h+Math.abs(d.t)):(g=0,l=h.h)):"horizontal"===this.get("type")?(d&&0<d.t?(l=this._clipval-Math.abs(d.t),g=-d.t):d&&0>d.t?(g=0,l=this._clipval+Math.abs(d.t)):(g=0,l=this._clipval),d&&0<d.l?(f=-d.l,k=h.w-d.l):d&&0>d.l?(f=0,k=h.w+Math.abs(d.l)):(f=0,k=h.w)):"scope"===this.get("type")&&(e?(f=n.l,k=n.w,g=n.t,l=n.h,"undefined"!==
typeof this.get("clip")&&(f+=this.get("clip"),k+=-(2*this.get("clip")),g+=this.get("clip"),l+=-(2*this.get("clip")))):(f=n.l,k=f+n.w,g=n.t,l=g+n.h,"undefined"!==typeof this.get("clip")&&(f+=this.get("clip"),k+=-this.get("clip"),g+=this.get("clip"),l+=-this.get("clip"))));if(c)if(e){if(e=c.getTransform())e.hasOwnProperty("dx")&&(f+=-e.dx),e.hasOwnProperty("dy")&&(g+=-e.dy);c.setClip({x:f,y:g,width:k,height:l})}else{if("undefined"!==typeof k&&"undefined"!==typeof f&&"undefined"!==typeof g&&"undefined"!==
typeof l){n=e=0;if("css-transforms"===this.map.navigationMode){var m="";s("webkit")&&(m="-webkit-");s("ff")&&(m="-moz-");s("ie")&&(m="-ms-");s("opera")&&(m="-o-");var p=c.style;if(p&&(m=p.getPropertyValue(m+"transform"))){-1!==m.toLowerCase().indexOf("translate3d")?m=m.replace("translate3d(","").replace(")","").replace(/px/ig,"").replace(/\s/i,"").split(","):-1!==m.toLowerCase().indexOf("translate")&&(m=m.replace("translate(","").replace(")","").replace(/px/ig,"").replace(/\s/i,"").split(","));try{e=
parseFloat(m[0]),n=parseFloat(m[1])}catch(r){console.error(r)}f-=e;k-=e;g-=n;l-=n}}e=s("ie");t.set(c,"clip",e&&8>e?"rect("+g+"px "+k+"px "+l+"px "+f+"px)":"rect("+g+"px, "+k+"px, "+l+"px, "+f+"px)")}}else console.log("LayerSwipe::Invalid layer type");a.layers.push({layer:this.layers[b],left:f,right:k,top:g,bottom:l})}this.emit("swipe",a)}},_updateThemeWatch:function(a,b,c){u.remove(this.domNode,b);u.add(this.domNode,c)},_type:function(a,b,c){b&&u.remove(this._moveableNode,b);this._setSwipeType();
this._setupEvents();this.swipe()},_pauseEvents:function(){if(this._listeners&&this._listeners.length)for(var a=0;a<this._listeners.length;a++)this._listeners[a].pause()},_resumeEvents:function(){if(this._listeners&&this._listeners.length)for(var a=0;a<this._listeners.length;a++)this._listeners[a].resume()},_unclipLayers:function(){if(this.get("loaded")&&this.layers&&this.layers.length)for(var a=0;a<this.layers.length;a++){var b=this.layers[a]._div,c=this.layers[a].graphics;b&&(c?b.setClip(null):(c=
s("ie"),t.set(b,"clip",c&&8>c?"rect(auto auto auto auto)":"auto")))}},_enabled:function(){this.get("enabled")?(t.set(this.domNode,"display","block"),this._resumeEvents(),this.swipe()):(this._pauseEvents(),t.set(this.domNode,"display","none"),this._unclipLayers())}});z("extend-esri")&&h.setObject("dijit.LayerSwipe",r,A);return r});